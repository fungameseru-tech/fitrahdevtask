<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard - Portfolio</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body class="bg-gray-100">

    <!-- Login Screen -->
    <div id="login-screen" class="min-h-screen flex items-center justify-center p-6">
        <div class="bg-white p-8 rounded-2xl shadow-xl max-w-md w-full">
            <div class="text-center mb-8">
                <h1 class="text-3xl font-bold mb-2">Admin Login</h1>
                <p class="text-gray-600">Enter your credentials to continue</p>
            </div>
            
            <form id="login-form" class="space-y-4">
                <div>
                    <label class="block text-sm font-semibold mb-2">Username</label>
                    <input type="text" name="username" required value="admin"
                           class="w-full px-4 py-3 rounded-lg border border-gray-300 focus:border-purple-500 focus:outline-none">
                </div>
                
                <div>
                    <label class="block text-sm font-semibold mb-2">Password</label>
                    <input type="password" name="password" required placeholder="Enter password"
                           class="w-full px-4 py-3 rounded-lg border border-gray-300 focus:border-purple-500 focus:outline-none">
                </div>
                
                <button type="submit" class="w-full px-6 py-3 bg-purple-600 text-white font-bold rounded-lg hover:bg-purple-700 transition">
                    <i class="fas fa-sign-in-alt mr-2"></i> Login
                </button>
                
                <a href="index.html" class="block text-center text-purple-600 hover:text-purple-700 transition">
                    ‚Üê Back to Portfolio
                </a>
            </form>
        </div>
    </div>

    <!-- Dashboard -->
    <div id="dashboard-screen" class="hidden">
        <!-- Sidebar -->
        <div class="fixed left-0 top-0 h-full w-64 bg-gray-900 text-white p-6 overflow-y-auto">
            <div class="mb-8">
                <h1 class="text-2xl font-bold">FITRAH.<span class="text-purple-500">ADMIN</span></h1>
            </div>
            
            <nav class="space-y-2">
                <a href="#" onclick="showSection('dashboard')" class="nav-item block px-4 py-3 rounded-lg bg-purple-600">
                    <i class="fas fa-home mr-2"></i> Dashboard
                </a>
                <a href="#" onclick="showSection('projects')" class="nav-item block px-4 py-3 rounded-lg hover:bg-gray-800">
                    <i class="fas fa-folder mr-2"></i> Projects
                </a>
                <a href="#" onclick="showSection('skills')" class="nav-item block px-4 py-3 rounded-lg hover:bg-gray-800">
                    <i class="fas fa-code mr-2"></i> Skills
                </a>
                <a href="#" onclick="showSection('experiences')" class="nav-item block px-4 py-3 rounded-lg hover:bg-gray-800">
                    <i class="fas fa-briefcase mr-2"></i> Experience
                </a>
                <a href="#" onclick="showSection('articles')" class="nav-item block px-4 py-3 rounded-lg hover:bg-gray-800">
                    <i class="fas fa-newspaper mr-2"></i> Articles
                </a>
                <a href="#" onclick="showSection('contacts')" class="nav-item block px-4 py-3 rounded-lg hover:bg-gray-800">
                    <i class="fas fa-envelope mr-2"></i> Messages
                </a>
                <a href="#" onclick="logout()" class="nav-item block px-4 py-3 rounded-lg hover:bg-red-600">
                    <i class="fas fa-sign-out-alt mr-2"></i> Logout
                </a>
            </nav>
        </div>

        <!-- Main Content -->
        <div class="ml-64 p-8">
            <!-- Dashboard Section -->
            <div id="section-dashboard" class="section">
                <div class="flex justify-between items-center mb-8">
                    <h2 class="text-3xl font-bold">Dashboard</h2>
                    <a href="index.html" target="_blank" class="px-6 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition">
                        <i class="fas fa-external-link-alt mr-2"></i> View Site
                    </a>
                </div>

                <!-- Stats Cards -->
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
                    <div class="bg-white p-6 rounded-xl shadow">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-gray-600 text-sm">Total Projects</p>
                                <p class="text-3xl font-bold" id="dash-projects">0</p>
                            </div>
                            <div class="w-12 h-12 bg-purple-100 rounded-full flex items-center justify-center">
                                <i class="fas fa-folder text-purple-600 text-xl"></i>
                            </div>
                        </div>
                    </div>
                    
                    <div class="bg-white p-6 rounded-xl shadow">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-gray-600 text-sm">Total Views</p>
                                <p class="text-3xl font-bold" id="dash-views">0</p>
                            </div>
                            <div class="w-12 h-12 bg-blue-100 rounded-full flex items-center justify-center">
                                <i class="fas fa-eye text-blue-600 text-xl"></i>
                            </div>
                        </div>
                    </div>
                    
                    <div class="bg-white p-6 rounded-xl shadow">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-gray-600 text-sm">Total Likes</p>
                                <p class="text-3xl font-bold" id="dash-likes">0</p>
                            </div>
                            <div class="w-12 h-12 bg-red-100 rounded-full flex items-center justify-center">
                                <i class="fas fa-heart text-red-600 text-xl"></i>
                            </div>
                        </div>
                    </div>
                    
                    <div class="bg-white p-6 rounded-xl shadow">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-gray-600 text-sm">Unread Messages</p>
                                <p class="text-3xl font-bold" id="dash-messages">0</p>
                            </div>
                            <div class="w-12 h-12 bg-green-100 rounded-full flex items-center justify-center">
                                <i class="fas fa-envelope text-green-600 text-xl"></i>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Recent Activity -->
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                    <div class="bg-white p-6 rounded-xl shadow">
                        <h3 class="text-xl font-bold mb-4">Recent Projects</h3>
                        <div id="recent-projects" class="space-y-3">
                            <!-- Will be loaded dynamically -->
                        </div>
                    </div>
                    
                    <div class="bg-white p-6 rounded-xl shadow">
                        <h3 class="text-xl font-bold mb-4">Recent Messages</h3>
                        <div id="recent-contacts" class="space-y-3">
                            <!-- Will be loaded dynamically -->
                        </div>
                    </div>
                </div>
            </div>

            <!-- Projects Section -->
            <div id="section-projects" class="section hidden">
                <div class="flex justify-between items-center mb-8">
                    <h2 class="text-3xl font-bold">Manage Projects</h2>
                    <button onclick="showAddProjectModal()" class="px-6 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition">
                        <i class="fas fa-plus mr-2"></i> Add Project
                    </button>
                </div>

                <div class="bg-white rounded-xl shadow overflow-hidden">
                    <div id="projects-list" class="divide-y">
                        <!-- Will be loaded dynamically -->
                    </div>
                </div>
            </div>

            <!-- Skills Section -->
            <div id="section-skills" class="section hidden">
                <div class="flex justify-between items-center mb-8">
                    <h2 class="text-3xl font-bold">Manage Skills</h2>
                    <button onclick="showAddSkillModal()" class="px-6 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition">
                        <i class="fas fa-plus mr-2"></i> Add Skill
                    </button>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-2 gap-6" id="skills-list">
                    <!-- Will be loaded dynamically -->
                </div>
            </div>

            <!-- Experience Section -->
            <div id="section-experiences" class="section hidden">
                <div class="flex justify-between items-center mb-8">
                    <h2 class="text-3xl font-bold">Manage Experience</h2>
                    <button onclick="showAddExperienceModal()" class="px-6 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition">
                        <i class="fas fa-plus mr-2"></i> Add Experience
                    </button>
                </div>

                <div class="space-y-4" id="experiences-list">
                    <!-- Will be loaded dynamically -->
                </div>
            </div>

            <!-- Articles Section -->
            <div id="section-articles" class="section hidden">
                <div class="flex justify-between items-center mb-8">
                    <h2 class="text-3xl font-bold">Manage Articles</h2>
                    <button onclick="showAddArticleModal()" class="px-6 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition">
                        <i class="fas fa-plus mr-2"></i> Add Article
                    </button>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6" id="articles-list">
                    <!-- Will be loaded dynamically -->
                </div>
            </div>

            <!-- Messages Section -->
            <div id="section-contacts" class="section hidden">
                <h2 class="text-3xl font-bold mb-8">Messages</h2>

                <div class="bg-white rounded-xl shadow overflow-hidden">
                    <div id="contacts-list" class="divide-y">
                        <!-- Will be loaded dynamically -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modals will go here -->
    <div id="modal-container"></div>

    <script>
        // API Configuration
        const API_BASE_URL = window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1'
            ? 'http://localhost:5000/api'
            : '/api'; // Will use relative path on production

        let token = localStorage.getItem('admin_token');
        let categories = [];

        // Check if logged in
        if (token) {
            showDashboard();
        }

        // Login Form
        document.getElementById('login-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            const formData = new FormData(e.target);
            const data = Object.fromEntries(formData);

            try {
                const res = await fetch(`${API_BASE_URL}/auth/login`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(data)
                });

                if (res.ok) {
                    const result = await res.json();
                    token = result.access_token;
                    localStorage.setItem('admin_token', token);
                    showDashboard();
                } else {
                    alert('‚ùå Invalid credentials');
                }
            } catch (error) {
                console.error('Login error:', error);
                alert('‚ùå Login failed');
            }
        });

        function showDashboard() {
            document.getElementById('login-screen').classList.add('hidden');
            document.getElementById('dashboard-screen').classList.remove('hidden');
            loadDashboardData();
            loadCategories();
        }

        function logout() {
            localStorage.removeItem('admin_token');
            location.reload();
        }

        async function loadCategories() {
            const res = await fetch(`${API_BASE_URL}/categories`);
            categories = await res.json();
        }

        async function loadDashboardData() {
            try {
                const res = await fetch(`${API_BASE_URL}/stats`);
                const stats = await res.json();
                
                document.getElementById('dash-projects').textContent = stats.total_projects;
                document.getElementById('dash-views').textContent = stats.total_views;
                document.getElementById('dash-likes').textContent = stats.total_likes;
                document.getElementById('dash-messages').textContent = stats.unread_messages;

                // Load recent data
                const dashRes = await fetch(`${API_BASE_URL}/dashboard`);
                const dashData = await dashRes.json();
                
                // Recent projects
                const recentProjects = document.getElementById('recent-projects');
                recentProjects.innerHTML = dashData.recent_projects.slice(0, 5).map(p => `
                    <div class="flex items-center gap-3 p-3 hover:bg-gray-50 rounded-lg">
                        <img src="${p.image}" class="w-12 h-12 rounded object-cover">
                        <div class="flex-1">
                            <p class="font-semibold text-sm">${p.title}</p>
                            <p class="text-xs text-gray-500">${p.views} views ¬∑ ${p.likes} likes</p>
                        </div>
                    </div>
                `).join('') || '<p class="text-gray-400 text-sm">No recent projects</p>';

                // Recent contacts
                const recentContacts = document.getElementById('recent-contacts');
                recentContacts.innerHTML = dashData.recent_contacts.slice(0, 5).map(c => `
                    <div class="p-3 hover:bg-gray-50 rounded-lg">
                        <p class="font-semibold text-sm">${c.name}</p>
                        <p class="text-xs text-gray-500">${c.email}</p>
                        <p class="text-xs text-gray-600 mt-1">${c.message.substring(0, 50)}...</p>
                    </div>
                `).join('') || '<p class="text-gray-400 text-sm">No new messages</p>';

            } catch (error) {
                console.error('Error loading dashboard:', error);
            }
        }

        function showSection(section) {
            // Hide all sections
            document.querySelectorAll('.section').forEach(s => s.classList.add('hidden'));
            
            // Show selected section
            document.getElementById(`section-${section}`).classList.remove('hidden');
            
            // Update nav active state
            document.querySelectorAll('.nav-item').forEach(item => {
                item.classList.remove('bg-purple-600');
                item.classList.add('hover:bg-gray-800');
            });
            event.target.classList.add('bg-purple-600');
            event.target.classList.remove('hover:bg-gray-800');
            
            // Load section data
            if (section === 'projects') loadProjects();
            else if (section === 'skills') loadSkills();
            else if (section === 'experiences') loadExperiences();
            else if (section === 'articles') loadArticles();
            else if (section === 'contacts') loadContacts();
        }

        async function loadProjects() {
            try {
                const res = await fetch(`${API_BASE_URL}/projects?per_page=50`);
                const data = await res.json();
                
                const list = document.getElementById('projects-list');
                list.innerHTML = data.projects.map(p => `
                    <div class="p-4 flex items-center gap-4 hover:bg-gray-50">
                        <img src="${p.image}" class="w-20 h-20 rounded object-cover">
                        <div class="flex-1">
                            <h3 class="font-bold">${p.title}</h3>
                            <p class="text-sm text-gray-600">${p.description.substring(0, 100)}...</p>
                            <div class="flex gap-4 text-xs text-gray-500 mt-1">
                                <span><i class="fas fa-eye"></i> ${p.views}</span>
                                <span><i class="fas fa-heart"></i> ${p.likes}</span>
                                <span><i class="fas fa-comments"></i> ${p.comments_count}</span>
                            </div>
                        </div>
                        <button onclick="deleteProject(${p.id})" class="px-4 py-2 bg-red-500 text-white rounded-lg hover:bg-red-600">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                `).join('');
            } catch (error) {
                console.error('Error loading projects:', error);
            }
        }

        async function deleteProject(id) {
            if (!confirm('Delete this project?')) return;
            
            try {
                await fetch(`${API_BASE_URL}/projects/${id}`, { method: 'DELETE' });
                loadProjects();
            } catch (error) {
                console.error('Error deleting project:', error);
            }
        }

        function showAddProjectModal() {
            const modal = document.getElementById('modal-container');
            modal.innerHTML = `
                <div class="fixed inset-0 bg-black/50 flex items-center justify-center p-6 z-50" onclick="closeModal(event)">
                    <div class="bg-white rounded-2xl p-8 max-w-2xl w-full max-h-[90vh] overflow-y-auto" onclick="event.stopPropagation()">
                        <h2 class="text-2xl font-bold mb-6">Add New Project</h2>
                        <form id="add-project-form" class="space-y-4">
                            <input type="text" name="title" placeholder="Project Title" required class="w-full px-4 py-3 border rounded-lg">
                            <textarea name="description" placeholder="Short Description" required class="w-full px-4 py-3 border rounded-lg" rows="3"></textarea>
                            <input type="url" name="image" placeholder="Image URL" required class="w-full px-4 py-3 border rounded-lg">
                            <input type="url" name="demo_url" placeholder="Demo URL (optional)" class="w-full px-4 py-3 border rounded-lg">
                            <input type="url" name="github_url" placeholder="GitHub URL (optional)" class="w-full px-4 py-3 border rounded-lg">
                            <select name="category_id" class="w-full px-4 py-3 border rounded-lg">
                                <option value="">Select Category</option>
                                ${categories.map(c => `<option value="${c.id}">${c.icon} ${c.name}</option>`).join('')}
                            </select>
                            <input type="text" name="tags" placeholder="Tags (comma separated)" class="w-full px-4 py-3 border rounded-lg">
                            <div class="flex gap-4">
                                <button type="submit" class="flex-1 px-6 py-3 bg-purple-600 text-white rounded-lg font-bold hover:bg-purple-700">
                                    Add Project
                                </button>
                                <button type="button" onclick="closeModal()" class="px-6 py-3 bg-gray-300 rounded-lg hover:bg-gray-400">
                                    Cancel
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
            `;
            
            document.getElementById('add-project-form').addEventListener('submit', async (e) => {
                e.preventDefault();
                const formData = new FormData(e.target);
                const data = Object.fromEntries(formData);
                
                try {
                    await fetch(`${API_BASE_URL}/projects`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(data)
                    });
                    closeModal();
                    loadProjects();
                    alert('‚úÖ Project added successfully!');
                } catch (error) {
                    console.error('Error adding project:', error);
                    alert('‚ùå Failed to add project');
                }
            });
        }

        async function loadSkills() {
            const res = await fetch(`${API_BASE_URL}/skills`);
            const skills = await res.json();
            
            document.getElementById('skills-list').innerHTML = skills.map(s => `
                <div class="bg-white p-6 rounded-xl shadow">
                    <div class="flex justify-between items-start mb-4">
                        <div>
                            <h3 class="font-bold text-lg">${s.icon || 'üîß'} ${s.name}</h3>
                            <p class="text-sm text-gray-600">${s.category || 'General'}</p>
                        </div>
                        <button onclick="deleteSkill(${s.id})" class="text-red-500 hover:text-red-700">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                    <div class="flex items-center gap-3">
                        <div class="flex-1 h-3 bg-gray-200 rounded-full overflow-hidden">
                            <div class="h-full bg-purple-600" style="width: ${s.level}%"></div>
                        </div>
                        <span class="font-bold text-sm">${s.level}%</span>
                    </div>
                </div>
            `).join('');
        }

        async function deleteSkill(id) {
            if (!confirm('Delete this skill?')) return;
            await fetch(`${API_BASE_URL}/skills/${id}`, { method: 'DELETE' });
            loadSkills();
        }

        function showAddSkillModal() {
            const modal = document.getElementById('modal-container');
            modal.innerHTML = `
                <div class="fixed inset-0 bg-black/50 flex items-center justify-center p-6 z-50" onclick="closeModal(event)">
                    <div class="bg-white rounded-2xl p-8 max-w-md w-full" onclick="event.stopPropagation()">
                        <h2 class="text-2xl font-bold mb-6">Add New Skill</h2>
                        <form id="add-skill-form" class="space-y-4">
                            <input type="text" name="name" placeholder="Skill Name" required class="w-full px-4 py-3 border rounded-lg">
                            <input type="text" name="icon" placeholder="Icon (emoji)" class="w-full px-4 py-3 border rounded-lg">
                            <input type="number" name="level" placeholder="Level (0-100)" min="0" max="100" required class="w-full px-4 py-3 border rounded-lg">
                            <input type="text" name="category" placeholder="Category" class="w-full px-4 py-3 border rounded-lg">
                            <div class="flex gap-4">
                                <button type="submit" class="flex-1 px-6 py-3 bg-purple-600 text-white rounded-lg font-bold hover:bg-purple-700">
                                    Add Skill
                                </button>
                                <button type="button" onclick="closeModal()" class="px-6 py-3 bg-gray-300 rounded-lg hover:bg-gray-400">
                                    Cancel
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
            `;
            
            document.getElementById('add-skill-form').addEventListener('submit', async (e) => {
                e.preventDefault();
                const formData = new FormData(e.target);
                const data = Object.fromEntries(formData);
                
                await fetch(`${API_BASE_URL}/skills`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(data)
                });
                closeModal();
                loadSkills();
            });
        }

        async function loadExperiences() {
            const res = await fetch(`${API_BASE_URL}/experiences`);
            const experiences = await res.json();
            
            document.getElementById('experiences-list').innerHTML = experiences.map(e => `
                <div class="bg-white p-6 rounded-xl shadow">
                    <div class="flex justify-between items-start">
                        <div class="flex-1">
                            <h3 class="font-bold text-lg">${e.title}</h3>
                            <p class="text-purple-600 font-semibold">${e.company}</p>
                            <p class="text-sm text-gray-600">${e.start_date} - ${e.end_date}</p>
                            ${e.location ? `<p class="text-sm text-gray-600"><i class="fas fa-map-marker-alt"></i> ${e.location}</p>` : ''}
                            ${e.description ? `<p class="text-sm text-gray-700 mt-2">${e.description}</p>` : ''}
                        </div>
                        <button onclick="deleteExperience(${e.id})" class="text-red-500 hover:text-red-700">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                </div>
            `).join('');
        }

        async function deleteExperience(id) {
            if (!confirm('Delete this experience?')) return;
            await fetch(`${API_BASE_URL}/experiences/${id}`, { method: 'DELETE' });
            loadExperiences();
        }

        function showAddExperienceModal() {
            const modal = document.getElementById('modal-container');
            modal.innerHTML = `
                <div class="fixed inset-0 bg-black/50 flex items-center justify-center p-6 z-50" onclick="closeModal(event)">
                    <div class="bg-white rounded-2xl p-8 max-w-2xl w-full" onclick="event.stopPropagation()">
                        <h2 class="text-2xl font-bold mb-6">Add Experience</h2>
                        <form id="add-experience-form" class="space-y-4">
                            <input type="text" name="title" placeholder="Job Title" required class="w-full px-4 py-3 border rounded-lg">
                            <input type="text" name="company" placeholder="Company" required class="w-full px-4 py-3 border rounded-lg">
                            <input type="text" name="location" placeholder="Location" class="w-full px-4 py-3 border rounded-lg">
                            <div class="grid grid-cols-2 gap-4">
                                <input type="text" name="start_date" placeholder="Start Date (e.g. Jan 2020)" required class="w-full px-4 py-3 border rounded-lg">
                                <input type="text" name="end_date" placeholder="End Date (leave empty if current)" class="w-full px-4 py-3 border rounded-lg">
                            </div>
                            <label class="flex items-center gap-2">
                                <input type="checkbox" name="current">
                                <span>Currently working here</span>
                            </label>
                            <textarea name="description" placeholder="Description" class="w-full px-4 py-3 border rounded-lg" rows="4"></textarea>
                            <div class="flex gap-4">
                                <button type="submit" class="flex-1 px-6 py-3 bg-purple-600 text-white rounded-lg font-bold hover:bg-purple-700">
                                    Add Experience
                                </button>
                                <button type="button" onclick="closeModal()" class="px-6 py-3 bg-gray-300 rounded-lg hover:bg-gray-400">
                                    Cancel
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
            `;
            
            document.getElementById('add-experience-form').addEventListener('submit', async (e) => {
                e.preventDefault();
                const formData = new FormData(e.target);
                const data = Object.fromEntries(formData);
                data.current = formData.get('current') === 'on';
                
                await fetch(`${API_BASE_URL}/experiences`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(data)
                });
                closeModal();
                loadExperiences();
            });
        }

        async function loadArticles() {
            const res = await fetch(`${API_BASE_URL}/articles?published=false`);
            const data = await res.json();
            
            document.getElementById('articles-list').innerHTML = data.articles.map(a => `
                <div class="bg-white rounded-xl shadow overflow-hidden">
                    ${a.cover_image ? `<img src="${a.cover_image}" class="w-full h-48 object-cover">` : ''}
                    <div class="p-6">
                        <h3 class="font-bold mb-2">${a.title}</h3>
                        <p class="text-sm text-gray-600 mb-4">${a.excerpt || a.content.substring(0, 100)}...</p>
                        <div class="flex justify-between items-center text-sm">
                            <span class="${a.published ? 'text-green-600' : 'text-gray-500'}">
                                ${a.published ? '‚úì Published' : '‚úó Draft'}
                            </span>
                            <span class="text-gray-500">${a.views} views</span>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        function showAddArticleModal() {
            alert('Article creation feature coming soon!');
        }

        async function loadContacts() {
            const res = await fetch(`${API_BASE_URL}/contacts`);
            const contacts = await res.json();
            
            document.getElementById('contacts-list').innerHTML = contacts.map(c => `
                <div class="p-6 ${c.read ? 'bg-gray-50' : 'bg-white'} hover:bg-gray-100">
                    <div class="flex justify-between items-start mb-2">
                        <div>
                            <h3 class="font-bold">${c.name}</h3>
                            <p class="text-sm text-gray-600">${c.email}</p>
                            ${c.subject ? `<p class="text-sm font-semibold text-purple-600 mt-1">${c.subject}</p>` : ''}
                        </div>
                        <div class="text-right">
                            <p class="text-xs text-gray-500">${new Date(c.created_at).toLocaleString()}</p>
                            ${!c.read ? '<span class="inline-block px-2 py-1 bg-green-500 text-white text-xs rounded-full mt-1">New</span>' : ''}
                        </div>
                    </div>
                    <p class="text-sm text-gray-700">${c.message}</p>
                    ${!c.read ? `<button onclick="markAsRead(${c.id})" class="mt-3 px-4 py-2 bg-purple-600 text-white rounded-lg text-sm hover:bg-purple-700">Mark as Read</button>` : ''}
                </div>
            `).join('');
        }

        async function markAsRead(id) {
            await fetch(`${API_BASE_URL}/contacts/${id}/read`, { method: 'PUT' });
            loadContacts();
            loadDashboardData();
        }

        function closeModal(event) {
            if (!event || event.target === event.currentTarget) {
                document.getElementById('modal-container').innerHTML = '';
            }
        }

        function showAddArticleModal() {
            alert('Feature under development');
        }
    </script>
</body>
</html>
